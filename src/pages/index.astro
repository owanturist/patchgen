---
import Layout from "~/layouts/Layout.astro"

import { ALL_PATCHES } from "~/tools/patch"

const columns = ALL_PATCHES.flatMap((patch) =>
  patch.tiles.map((row) => row.length),
).reduce((acc, val) => Math.max(acc, val), 0)
---

<Layout class="snap-y snap-mandatory">
  <div
    class="max-w-sm mx-auto grid px-4 py-6 divide-y-4 divide-dashed divide-gray-300"
    style={{
      gridTemplateColumns: `repeat(${columns}, minmax(0, auto))`,
    }}
  >
    {
      ALL_PATCHES.map((patch) => (
        <div class="grid col-span-full grid-cols-subgrid min-h-screen items-center justify-center snap-center">
          <div class="grid col-span-full grid-cols-subgrid gap-px">
            {patch.tiles.map((row, rowIndex) => {
              return row.map((tile, colIndex) => {
                if (tile === 0) {
                  return null
                }
                return (
                  <div
                    class="bg-gray-300 ring-1 aspect-square flex justify-center items-center"
                    style={{
                      gridColumnStart: colIndex + 1,
                      gridRowStart: rowIndex + 1,
                    }}
                  >
                    {tile === 2 && (
                      <div class="size-3/5 bg-blue-400 rounded-full" />
                    )}
                  </div>
                )
              })
            })}

            <div class="col-span-full">
              <p class="font-bold">Price: {patch.price}</p>
              <p>Time: {patch.time}</p>
            </div>
          </div>
        </div>
      ))
    }
  </div>
</Layout>
